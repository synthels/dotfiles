%% licensed under the MIT license. See LICENSE file in the project root for details.

% synthels' LaTeX preamble
%
% usage:
%   \usepackage[options]{synthels}
%
% use only with LuaTeX/XeTeX!
%
% options:
%   - handout:    for my handouts.
%   - olympiad:   for writing up solutions to problems.
%   - unicode:    enables a unicode font.
%   - fancythm:   theorem environments come with a fancy box.
%   - fancyprob:  problem environments come with a fancy box.
%   - tikz:       loads TikZ & asymptote.
%   - wide:       increases L/R margins.
%

\ProvidesPackage{synthels}

\RequirePackage{kvoptions}

% package options
\DeclareBoolOption{handout}
\DeclareBoolOption{olympiad}
\DeclareBoolOption{unicode}
\DeclareBoolOption{fancythm}
\DeclareBoolOption{fancyprob}
\DeclareBoolOption{tikz}
\DeclareBoolOption{wide}

\usepackage{amsmath, amsthm, amsfonts, amssymb}
\usepackage{titlesec}
\usepackage{hyperref}
\usepackage[many]{tcolorbox}
\usepackage[shortlabels]{enumitem}
\usepackage[dvipsnames]{xcolor}

\ProcessKeyvalOptions*

% check if options are illegal
\ifsynthels@olympiad
  \ifsynthels@fancythm
    \PackageError{synthels}{can't use olympiad and fancythm options together!}
  \fi
\fi

% adds a header, also wide and fancythm
\ifsynthels@handout
  \PassOptionsToPackage{wide}{synthels}
  \PassOptionsToPackage{fancythm}{synthels}
  \ProcessKeyvalOptions*

  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{synthels}
  \fancyhead[R]{\date{\today}}

  \ifsynthels@wide
    \fancyhfoffset[LE,RO]{.15cm}
  \fi
\fi

% enables libertinus
\ifsynthels@unicode
  \usepackage{libertinus}
\fi

% loads TikZ & asy
\ifsynthels@tikz
  \usepackage{tikz-cd}
  \usepackage{asymptote}
\fi

\ifsynthels@wide
  \usepackage[a4paper,
    bindingoffset=0.2in,
    left=1in,
    right=1in,
    top=1in,
    bottom=1in,
    footskip=.25in
  ]{geometry}
\fi

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
}

% provides a "solution" environment
\newenvironment{solution}{
  \paragraph{
    \textnormal{\textit{Solution.}}
  }
}{\hfill$\square$}

% stupid theorem styles
\newcommand{\newfancytheoremstyle}[2]{
\newtheoremstyle{#1}
  {3pt}
  {3pt}
  {\fontseries\mddefault}
  {}
  {\bfseries\color{#2}}
  {\;---}
  { }
  {}
}

% defines a theorem with a fancy box
% usage:
%   \newfancytheorem{name}{color}{arc}
\newcommand{\newfancytheorem}[3]{
  \newfancytheoremstyle{#1}{#2}
  \theoremstyle{#1}
  \newtheorem{_#1}{{\color{#2}\MakeUppercase #1}}
  \newenvironment{#1}{
    \begin{tcolorbox}[
      arc=#3,
      colback=#2!10!white,
      colframe=#2!80!black,
      boxrule=0.1mm
    ]{}{}
  \begin{_#1}
  }
  {
    \end{_#1}
    \end{tcolorbox}
  }
}

% defines a theorem with a (small, square) fancy box
% same usage as above
\newcommand{\newolytheorem}[2]{
  \newfancytheoremstyle{#1}{#2}
  \theoremstyle{#1}
  \newtheorem{_#1}{{\color{#2}\MakeUppercase #1}}
  \newenvironment{#1}{
    \begin{tcolorbox}[
      enhanced,
      arc=0mm,
      colback=#2!10!white,
      colframe=#2!10!white,
      borderline west={2pt}{0pt}{#2},
      boxrule=0mm
    ]{}{}
  \begin{_#1}
  }
  {
    \end{_#1}
    \end{tcolorbox}
  }
}

\theoremstyle{definition}
\newtheorem{definition}{Definition}

% problem environment
\ifsynthels@fancyprob
  \newfancytheorem{problem}{Purple}{2mm}
\else
  \newtheorem{problem}{Problem}
\fi

% theorem, lemma, example
\ifsynthels@fancythm
  \newfancytheorem{theorem}{Blue}{2mm}
  \newfancytheorem{lemma}{Green}{2mm}
\fi

\ifsynthels@olympiad
  \newolytheorem{theorem}{Blue}
  \newolytheorem{lemma}{Green}
  \newolytheorem{claim}{Orange}
\else
  \theoremstyle{plain}
  \newtheorem{theorem}{Theorem}
  \newtheorem{lemma}{Lemma}
\fi

\newfancytheorem{example}{BrickRed}{0mm}

% macros
\DeclareMathOperator*{\lcm}{lcm}
\DeclareMathOperator*{\ord}{ord}

% sets
\newcommand{\CC}{\mathbb{C}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\FF}{\mathbf{F}}

% (re)new commands
\renewcommand{\textbf}[1]{{\bfseries\color{blue}{#1}}}
